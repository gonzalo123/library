/*
 * OpenUI5
 * (c) Copyright 2009-2024 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["./RowMode","../utils/TableUtils","sap/ui/Device","sap/m/Menu","sap/m/MenuItem"],function(t,e,o,n,i){"use strict";const s=e.createWeakMapFacade();const a=t.extend("sap.ui.table.rowmodes.Interactive",{metadata:{library:"sap.ui.table",final:true,properties:{rowCount:{type:"int",defaultValue:10,group:"Appearance"},minRowCount:{type:"int",defaultValue:5,group:"Appearance"},maxRowCount:{type:"int",defaultValue:-1,group:"Appearance"},fixedTopRowCount:{type:"int",defaultValue:0,group:"Appearance"},fixedBottomRowCount:{type:"int",defaultValue:0,group:"Appearance"},rowContentHeight:{type:"int",defaultValue:0,group:"Appearance"}}},constructor:function(e){Object.defineProperty(this,"bLegacy",{value:typeof e==="boolean"?e:false});t.apply(this,arguments)}});const r={};const u={};a.prototype.attachEvents=function(){t.prototype.attachEvents.apply(this,arguments);e.addDelegate(this.getTable(),r,this)};a.prototype.detachEvents=function(){t.prototype.detachEvents.apply(this,arguments);e.removeDelegate(this.getTable(),r)};a.prototype.registerHooks=function(){t.prototype.registerHooks.apply(this,arguments);e.Hook.register(this.getTable(),e.Hook.Keys.Table.RefreshRows,this._onTableRefreshRows,this)};a.prototype.deregisterHooks=function(){t.prototype.deregisterHooks.apply(this,arguments);e.Hook.deregister(this.getTable(),e.Hook.Keys.Table.RefreshRows,this._onTableRefreshRows,this)};a.prototype.getRowCount=function(){if(this.bLegacy){const t=this.getTable();return t?t.getVisibleRowCount():0}return this.getProperty("rowCount")};a.prototype.getFixedTopRowCount=function(){if(this.bLegacy){const t=this.getTable();return t?t.getFixedRowCount():0}return this.getProperty("fixedTopRowCount")};a.prototype.getFixedBottomRowCount=function(){if(this.bLegacy){const t=this.getTable();return t?t.getFixedBottomRowCount():0}return this.getProperty("fixedBottomRowCount")};a.prototype.getMinRowCount=function(){if(this.bLegacy){const t=this.getTable();return t?t.getMinAutoRowCount():0}return this.getProperty("minRowCount")};a.prototype.getRowContentHeight=function(){if(this.bLegacy){const t=this.getTable();return t?t.getRowHeight():0}return this.getProperty("rowContentHeight")};a.prototype.getMinRequestLength=function(){return this.getActualRowCount()};a.prototype.getComputedRowCounts=function(){const t=this.getActualRowCount();const e=this.getFixedTopRowCount();const o=this.getFixedBottomRowCount();return this.computeStandardizedRowCounts(t,e,o)};a.prototype.getTableStyles=function(){return{height:"auto"}};a.prototype.getRowContainerStyles=function(){const t=this.getComputedRowCounts().count*this.getBaseRowHeightOfTable()+"px";if(this.bLegacy&&!e.isVariableRowHeightEnabled(this.getTable())){return{minHeight:t}}return{height:t}};a.prototype.renderRowStyles=function(t){const e=this.getRowContentHeight();if(e>0){t.style("height",this.getBaseRowHeightOfTable()+"px")}};a.prototype.renderCellContentStyles=function(t){let e=this.getRowContentHeight();if(this.bLegacy){return}if(e<=0){e=this.getDefaultRowContentHeightOfTable()}if(e>0){t.style("max-height",e+"px")}};a.prototype.renderInTableBottomArea=function(t){const o=this.getTable();t.openStart("div",o.getId()+"-heightResizer").attr("role","separator").attr("aria-orientation","horizontal").attr("title",e.getResourceText("TBL_RSZ_BTN_TOOLTIP")).attr("tabindex","0").attr("aria-valuemin",this.getMinRowCount()).attr("aria-valuenow",this.getActualRowCount()).class("sapUiTableHeightResizer");const n=o.getAriaLabelledBy();if(n.length){t.attr("aria-labelledby",n.join(" "))}t.openEnd();t.openStart("div").class("sapUiTableHeightResizerDecorationBefore").openEnd().close("div");t.openStart("div").attr("role","presentation").class("sapUiTableHeightResizerGrip").openEnd().icon("sap-icon://horizontal-grip",["sapUiTableHeightResizerGripIcon"]).close("div");t.openStart("div").class("sapUiTableHeightResizerDecorationAfter").openEnd().close("div");t.close("div")};a.prototype.getBaseRowContentHeight=function(){return Math.max(0,this.getRowContentHeight())};a.prototype._onTableRefreshRows=function(){const t=this.getActualRowCount();if(t>0){this.initTableRowsAfterDataRequested(t);this.getRowContexts(t)}};a.prototype.getActualRowCount=function(){return Math.max(0,this.getMinRowCount(),s(this).rowCount||this.getRowCount())};a.prototype._getMaxRowCount=function(){const t=this.getMaxRowCount();const e=this.getMinRowCount();if(t>=0){return Math.max(t,e)}const o=this._determineAvailableSpace();return Math.max(Math.floor(o/this.getBaseRowHeightOfTable()),e)};a.prototype._determineAvailableSpace=function(){const t=this.getTable();const e=t.getDomRef();const n=t.getDomRef("tableCCnt");const i=o.resize.height;if(!e||!n){return 0}return Math.max(0,Math.floor(i-e.getBoundingClientRect().height+n.getBoundingClientRect().height))};a.prototype.setRowCount=function(t){this.setProperty("rowCount",t);s(this).rowCount=t;return this};a.prototype.updateTable=function(e){this.getTable().getDomRef("heightResizer")?.setAttribute("aria-valuenow",this.getActualRowCount());t.prototype.updateTable.apply(this,arguments)};r.onBeforeRendering=function(t){if(this.bLegacy){this.getTable().setVisibleRowCount(this.getComputedRowCounts().count)}};r.onAfterRendering=function(t){const o=this.getTable();const n=t&&t.isMarked("renderRows");if(!n&&o.getRows().length>0){this.fireRowsUpdated(e.RowsUpdateReason.Render)}const i=o.getDomRef("heightResizer");i.setAttribute("aria-valuemax",this._getMaxRowCount())};r.onmousedown=function(t){const e=this.getTable();if(t.button===0&&e.getDomRef("heightResizer").contains(t.target)){u.initResizing(e,this,t)}};r.oncontextmenu=function(t){const e=this.getTable();const o=e.getDomRef("heightResizer");if(o.contains(t.target)){t.preventDefault();o.classList.add("sapUiTableHeightResizerActive");u.openContextMenu(e,this,t)}};r.onkeydown=function(t){const o=this.getTable();if(t.target===o.getDomRef("heightResizer")){switch(t.key){case"ArrowUp":t.preventDefault();s(this).rowCount=Math.max(this.getActualRowCount()-1,this.getMinRowCount());this.updateTable(e.RowsUpdateReason.Render);break;case"ArrowDown":t.preventDefault();s(this).rowCount=Math.min(this.getActualRowCount()+1,this._getMaxRowCount());this.updateTable(e.RowsUpdateReason.Render);break;case"Home":t.preventDefault();s(this).rowCount=this.getMinRowCount();this.updateTable(e.RowsUpdateReason.Render);break;case"End":t.preventDefault();s(this).rowCount=this._getMaxRowCount();this.updateTable(e.RowsUpdateReason.Render);break;default:}}};r.ondblclick=function(t){if(!this.getTable().getDomRef("heightResizer").contains(t.target)){return}const o=this.getActualRowCount();if(o===this._getMaxRowCount()){s(this).rowCount=this.getMinRowCount()}else if(o===this.getMinRowCount()){s(this).rowCount=this.getRowCount()}else{s(this).rowCount=this._getMaxRowCount()}this.updateTable(e.RowsUpdateReason.Render)};u.initResizing=function(t,e,o){t._disableTextSelection();u._oTable=t;u._iResizerStartPos=o.pageY;document.addEventListener("touchend",u.onResizingEnd.bind(t,e),{once:true});document.addEventListener("touchmove",u.onResizerMove);document.addEventListener("mouseup",u.onResizingEnd.bind(t,e),{once:true});document.addEventListener("mousemove",u.onResizerMove);const n=t.getDomRef("heightResizer");n.classList.add("sapUiTableHeightResizerActive");n.style.top="0"};u.onResizerMove=function(t){const e=t.pageY-u._iResizerStartPos;u._oTable.getDomRef("heightResizer").style.top=e+"px"};u.onResizingEnd=function(t,o){const n=e.getEventPosition(o,this).y;const i=this.getDomRef("tableCCnt").getBoundingClientRect().top;const a=this.getDomRef().querySelector(".sapUiTableFtr");const r=a?a.getBoundingClientRect().height:0;const g=n-i-r;const h=Math.floor(g/t.getBaseRowHeightOfTable());let R=Math.max(0,h,t.getMinRowCount());const p=t._getMaxRowCount();if(p>0){R=Math.min(R,p)}if(t.bLegacy){R=Math.max(R,t.getFixedTopRowCount()+t.getFixedBottomRowCount()+1);this.setVisibleRowCount(R)}s(t).rowCount=R;t.updateTable(e.RowsUpdateReason.Render);document.removeEventListener("touchmove",u.onResizerMove);document.removeEventListener("mousemove",u.onResizerMove);const c=this.getDomRef("heightResizer");c.classList.remove("sapUiTableHeightResizerActive");c.style.top="";this._enableTextSelection()};u.openContextMenu=function(t,o,a){if(!u._oContextMenu){u._oContextMenu=new n({items:[new i({text:e.getResourceText("TBL_RSZ_ROW_UP"),shortcutText:e.getResourceText("TBL_RSZ_ROW_UP_SHORTCUT"),press:function(){const t=o.getActualRowCount();s(o).rowCount=Math.max(t-1,o.getMinRowCount());o.updateTable(e.RowsUpdateReason.Render)}}),new i({text:e.getResourceText("TBL_RSZ_ROW_DOWN"),shortcutText:e.getResourceText("TBL_RSZ_ROW_DOWN_SHORTCUT"),press:function(){const t=o.getActualRowCount();s(o).rowCount=Math.min(t+1,o._getMaxRowCount());o.updateTable(e.RowsUpdateReason.Render)}}),new i({text:e.getResourceText("TBL_RSZ_MINIMIZE"),shortcutText:e.getResourceText("TBL_RSZ_MINIMIZE_SHORTCUT"),press:function(){s(o).rowCount=o.getMinRowCount();o.updateTable(e.RowsUpdateReason.Render)}}),new i({text:e.getResourceText("TBL_RSZ_MAXIMIZE"),shortcutText:e.getResourceText("TBL_RSZ_MAXIMIZE_SHORTCUT"),press:function(){s(o).rowCount=o._getMaxRowCount();o.updateTable(e.RowsUpdateReason.Render)}})],closed:function(){t.getDomRef("heightResizer").classList.remove("sapUiTableHeightResizerActive")}});u._oContextMenu.openAsContextMenu(a,t.getDomRef("heightResizer"))}else{u._oContextMenu.openAsContextMenu(a,t.getDomRef("heightResizer"))}};return a});
//# sourceMappingURL=Interactive.js.map